<!DOCTYPE html>
<html>
<head>
  <title>AI Music Generator</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    #loading { display: none; color: #007bff; }
    #error { color: red; display: none; }
    #player { display: none; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Generate AI Music</h1>
  <button id="generateBtn">Generate Music</button>
  <span id="loading">Generating music, please wait...</span>
  <div id="error"></div>
  <audio id="player" controls></audio>
  <script>
    const btn = document.getElementById('generateBtn');
    const loading = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const player = document.getElementById('player');

    btn.onclick = async function(e) {
      e.preventDefault();
      errorDiv.style.display = 'none';
      player.style.display = 'none';
      loading.style.display = 'inline';
      btn.disabled = true;
      try {
        const response = await fetch('/generate', { method: 'POST' });
        loading.style.display = 'none';
        btn.disabled = false;
        if (!response.ok) {
          const data = await response.json();
          errorDiv.textContent = data.error || 'Music generation failed.';
          errorDiv.style.display = 'block';
          return;
        }
        // Create a blob URL for the audio
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        player.src = url;
        player.style.display = 'block';
        player.load();
        player.play();
      } catch (err) {
        loading.style.display = 'none';
        btn.disabled = false;
        errorDiv.textContent = 'An error occurred: ' + err;
        errorDiv.style.display = 'block';
      }
    };
  </script>
</body>
</html>